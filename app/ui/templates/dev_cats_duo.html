{% extends "base.html" %}
{% block content %}
<h1>Duo Cat Atlas Preview</h1>

<div class="card">
  <h2>Controls</h2>
  <div class="grid">
    <label>
      Clip
      <select id="duo-clip">
        <option value="snuggle_idle" selected>snuggle_idle</option>
        <option value="mutual_groom">mutual_groom</option>
        <option value="nose_boop">nose_boop</option>
        <option value="snuggle_curl">snuggle_curl</option>
        <option value="play_pounce">play_pounce</option>
        <option value="paw_batting">paw_batting</option>
        <option value="chase_loop">chase_loop</option>
        <option value="bunny_kick">bunny_kick</option>
        <option value="standing_swat">standing_swat</option>
        <option value="standoff">standoff</option>
        <option value="explosive_clash">explosive_clash</option>
        <option value="ear_cleaning">ear_cleaning</option>
        <option value="face_wash_assist">face_wash_assist</option>
      </select>
    </label>
    <label>
      Scale
      <input id="duo-scale" type="range" min="0.1" max="0.8" step="0.01" value="0.25" />
      <span id="duo-scale-value">0.25x</span>
    </label>
    <label>
      Speed
      <input id="duo-speed" type="range" min="0.25" max="3" step="0.05" value="1" />
      <span id="duo-speed-value">1.00x</span>
    </label>
    <label>
      <input id="duo-pause" type="checkbox" />
      Pause
    </label>
  </div>
</div>

<div class="card">
  <h2>Sprite</h2>
  {% include "partials/cat_duo_widget.html" %}
</div>

<script>
  (function () {
    function setup() {
      var root = document.querySelector("[data-duo-cat].cat-duo-widget");
      if (!root || !window.DuoCats) {
        return;
      }
      var clip = document.getElementById("duo-clip");
      var scale = document.getElementById("duo-scale");
      var speed = document.getElementById("duo-speed");
      var speedValue = document.getElementById("duo-speed-value");
      var scaleValue = document.getElementById("duo-scale-value");
      var pause = document.getElementById("duo-pause");

      function apply() {
        root.dataset.clip = clip.value;
        root.dataset.scale = scale.value;
        root.dataset.speed = speed.value;
        root.dataset.pause = pause.checked ? "true" : "false";
        speedValue.textContent = Number.parseFloat(speed.value).toFixed(2) + "x";
        scaleValue.textContent = Number.parseFloat(scale.value).toFixed(2) + "x";
        window.DuoCats.refresh(root);
      }

      clip.addEventListener("change", apply);
      scale.addEventListener("input", apply);
      speed.addEventListener("input", apply);
      pause.addEventListener("change", apply);
      apply();
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", setup);
    } else {
      setup();
    }
  })();
</script>
{% endblock %}
